var args = process.argv;
var argsLength = args.length;
if (argsLength < 4) {
    var hash = '\n##################################################\n';
    console.log('\nFor fÃ¥ argumenter:' + hash + 'Riktig bruk er: node uglify-singles.js inputdir outputfile' + hash);
}

console.log('Arguments: ', args);

var fs = require('fs');
var ugly = require('uglify-js');
var parser = ugly.parser;
var uglify = ugly.uglify;


var files = fs.readdir(args[2], function(err, list) {
    if (err) {
        return err;
    }
    list.forEach(function(file, i) {
        var ind = file.indexOf('.js');
        if (file.substring(0, 1) !== '.' && ind > -1) {
            console.log('File: ' + i + ': ', file);
            var code = fs.readFileSync(args[2] + file, 'utf8');
            var tree = parser.parse(code);
            tree = uglify.ast_mangle(tree);
            tree = uglify.ast_squeeze(tree);
            var finalCode = uglify.gen_code(tree);
            fs.writeFileSync(args[3] + file.substring(0, ind) + '.min.js', finalCode, 'utf8');
        }
    });
});
